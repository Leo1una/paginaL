{% extends "base.html" %} {% block title %}QR Studio LRLEDEV{% endblock %}
{%block content %}
<div class="container text-center">
	<h1 class="fw-bold text-primary mb-4">Generador QR</h1>

	<form
		id="qrForm"
		enctype="multipart/form-data"
		class="mx-auto"
		style="max-width: 750px">
		{% csrf_token %}

		<div class="mb-3">
			<label for="tipo">Tipo de contenido</label>
			<select name="tipo" id="tipo" class="form-select">
				<option value="link">Link</option>
				<option value="email">Email</option>
				<option value="telefono">Tel칠fono</option>
				<option value="whatsapp">WhatsApp</option>
				<option value="texto">Texto</option>
				<option value="wifi">Wi-Fi</option>
			</select>
		</div>

		<div id="inputs" class="text-start"></div>

		<div class="row mb-3">
			<div class="col-md-6">
				<label>Color principal</label>
				<input
					type="color"
					name="color"
					value="#000000"
					class="form-control form-control-color" />
			</div>
			<div class="col-md-6">
				<label>Fondo</label>
				<input
					type="color"
					name="fondo"
					value="#ffffff"
					class="form-control form-control-color" />
			</div>
		</div>

		<div class="row mb-3">
			<div class="col-md-6">
				<label>Forma de puntos</label>
				<select name="puntos" class="form-select">
					<option value="square">Cuadrados</option>
					<option value="round">Redondos</option>
					<option value="bubble">Burbujas</option>
				</select>
			</div>
			<div class="col-md-6">
				<label>Marco</label>
				<select name="frame" class="form-select">
					<option value="none">Ninguno</option>
					<option value="circle">Circular</option>
					<option value="scan">Escaneo</option>
				</select>
			</div>
		</div>

		<div class="mb-3">
			<label>Logo opcional</label>
			<input type="file" name="logo" class="form-control" accept="image/*" />
		</div>

		<button class="btn w-100 fw-bold">Generar QR</button>
	</form>

	<div id="qrPreview" class="mt-4"></div>
</div>
{% endblock %} {% block scripts %}
<script>
	const tipo = document.getElementById("tipo");
	const inputZone = document.getElementById("inputs");
	const qrForm = document.getElementById("qrForm");
	const qrPreview = document.getElementById("qrPreview");

	function renderInputs() {
		const t = tipo.value;
		let html = "";

		if (t === "link") {
			html = `
				<label>Introduce tu enlace:</label>
				<input type="url" name="contenido" placeholder="https://ejemplo.com" class="form-control mb-3" required>
			`;
		} else if (t === "email") {
			html = `
				<label>Correo electr칩nico:</label>
				<p class="small text-info">Se generar치 un enlace mailto autom치ticamente.</p>
				<input type="email" name="contenido" placeholder="ejemplo@correo.com" class="form-control mb-3" required>
			`;
		} else if (t === "telefono") {
			html = `
				<label>N칰mero telef칩nico:</label>
				<p class="small text-info">Incluye el c칩digo de pa칤s (ej. +525512345678)</p>
				<input type="tel" name="contenido" placeholder="+52..." class="form-control mb-3" required>
			`;
		} else if (t === "whatsapp") {
			html = `
				<label>WhatsApp:</label>
				<p class="small text-info">N칰mero con c칩digo de pa칤s y mensaje opcional.</p>
				<input type="text" name="numero" placeholder="5217712345678" class="form-control mb-2" required>
				<input type="text" name="mensaje" placeholder="Mensaje opcional" class="form-control">
			`;
		} else if (t === "texto") {
			html = `
				<label>Texto libre:</label>
				<input type="text" name="contenido" placeholder="Escribe el texto para tu QR" class="form-control mb-3" required>
			`;
		} else if (t === "wifi") {
			html = `
				<label>Red Wi-Fi:</label>
				<p class="small text-info">Introduce el nombre (SSID) y la contrase침a de tu red.</p>
				<input type="text" name="ssid" placeholder="Nombre de red (SSID)" class="form-control mb-2" required>
				<input type="password" name="password" placeholder="Contrase침a" class="form-control" required>
			`;
		}
		inputZone.innerHTML = html;
	}
	tipo.addEventListener("change", renderInputs);
	renderInputs();

	// 丘뙖잺 Generar QR Preview
	async function generarPreview() {
		const formData = new FormData(qrForm);
		if (![...formData.values()].some((v) => v && v !== "")) return;

		const res = await fetch("{% url 'generar_qr' %}", {
			method: "POST",
			body: formData,
		});
		try {
			const data = await res.json();
			if (data.success) {
				qrPreview.innerHTML = `
					<img src="${data.png}" alt="QR" class="img-fluid rounded-3 shadow-lg border border-primary">
					<div class="mt-3 d-flex gap-2 justify-content-center">
						<a href="${data.png}" download="QR_LRLEDEV.png" class="btn download-btn">Descargar PNG</a>
						<a href="${data.svg}" download="QR_LRLEDEV.svg" class="btn download-btn">Descargar SVG</a>
					</div>
				`;

				// 游릱 Al descargar, mostrar alerta
				document.querySelectorAll(".download-btn").forEach((btn) => {
					btn.addEventListener("click", () => {
						setTimeout(() => {
							Swal.fire({
								icon: "success",
								title: "Descarga completada",
								text: "Tu c칩digo QR se descarg칩 correctamente.",
								timer: 1800,
								showConfirmButton: false,
							});
						}, 500);
					});
				});
			}
		} catch {}
	}

	qrForm.addEventListener("input", generarPreview);
	qrForm.addEventListener("submit", async (e) => {
		e.preventDefault();
		await generarPreview();
		Swal.fire({
			icon: "success",
			title: "QR actualizado",
			timer: 1500,
			showConfirmButton: false,
		});
	});
</script>
{% endblock %}
